cd ~/hormozgan-driver-pro121



#!/data/data/com.termux/files/usr/bin/bash

set -e

echo "🚀 استقرار خودکار پروژه هورمزگان درایور"
echo "========================================"

# رنگ‌ها
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# توابع نمایش
log() { echo -e "${YELLOW}[ℹ]${NC} $1"; }
info() { echo -e "${BLUE}[→]${NC} $1"; }
success() { echo -e "${GREEN}[✓]${NC} $1"; }
error() { echo -e "${RED}[✗]${NC} $1"; }

# مسیر پروژه
PROJECT_DIR="$(pwd)"
GITHUB_REPO="https://github.com/mahdihadari59-lgtm/hormozgan-driver-website.git"
RENDER_URL="https://hormozgan-driver-pro121.onrender.com"

# تابع بررسی وضعیت
check_status() {
    log "بررسی وضعیت پروژه..."
    
    if [ ! -d ".git" ]; then
        error "این پوشه یک ریپوزیتوری Git نیست!"
        exit 1
    fi
    
    # بررسی اتصال اینترنت
    if ! ping -c 1 github.com &> /dev/null; then
        error "اتصال به اینترنت مشکل دارد!"
        exit 1
    fi
    
    success "بررسی وضعیت انجام شد"
}

# تابع نمایش فایل‌های ایجاد شده
show_created_files() {
    log "فایل‌های ایجاد شده:"
    echo ""
    echo "📁 فایل‌های جدید:"
    echo "   📄 notifications-system.html (سیستم اعلان‌ها)"
    echo "   📄 rating-system.html (سیستم امتیازدهی)"
    echo "   📄 advanced-dashboard.html (داشبورد پیشرفته)"
    echo "   📄 auto-deploy.sh (اسکریپت استقرار)"
    echo ""
    
    # نمایش حجم فایل‌ها
    for file in notifications-system.html rating-system.html advanced-dashboard.html; do
        if [ -f "$file" ]; then
            size=$(du -h "$file" | cut -f1)
            lines=$(wc -l < "$file")
            echo "   📊 $file: $size, $lines خط"
        fi
    done
}

# تابع ادغام با index.html
integrate_with_index() {
    log "ادغام فایل‌های جدید با صفحه اصلی..."
    
    if [ ! -f "index.html" ]; then
        error "فایل index.html یافت نشد!"
        return 1
    fi
    
    # ایجاد پشتیبان
    cp index.html index.html.backup
    success "پشتیبان از index.html ایجاد شد"
    
    # اضافه کردن فایل‌ها به index.html (ساده شده)
    echo "<!-- فایل‌های جدید اضافه شده -->" >> index.html
    echo "<!-- سیستم اعلان‌ها -->" >> index.html
    cat notifications-system.html >> index.html
    echo "<!-- سیستم امتیازدهی -->" >> index.html
    cat rating-system.html >> index.html
    echo "<!-- داشبورد پیشرفته -->" >> index.html
    cat advanced-dashboard.html >> index.html
    
    success "فایل‌های جدید با صفحه اصلی ادغام شدند"
}

# تابع ارسال به GitHub
push_to_github() {
    log "ارسال تغییرات به GitHub..."
    
    # بررسی تغییرات
    if git status --porcelain | grep -q .; then
        info "تغییرات شناسایی شد:"
        git status --short
        
        # اضافه کردن فایل‌ها
        git add .
        
        # کامیت
        git commit -m "🚀 افزودن قابلیت‌های جدید: سیستم اعلان، امتیازدهی و داشبورد پیشرفته - $(date '+%Y-%m-%d %H:%M')"
        
        # پوش به GitHub
        info "ارسال به GitHub..."
        git push origin main
        
        success "تغییرات با موفقیت به GitHub ارسال شد"
    else
        info "هیچ تغییری برای کامیت وجود ندارد"
    fi
}

# تابع بررسی استقرار
check_deployment() {
    log "بررسی استقرار خودکار..."
    
    info "GitHub Pages باید به طور خودکار بروزرسانی شود"
    info "Render نیز باید استقرار خودکار را شروع کند"
    echo ""
    echo "🌐 لینک‌های پروژه:"
    echo "   - GitHub: $GITHUB_REPO"
    echo "   - Pages: https://mahdihadari59-lgtm.github.io/hormozgan-driver-website"
    echo "   - Render: $RENDER_URL"
    echo ""
    info "استقرار معمولاً ۲-۵ دقیقه طول می‌کشد"
}

# تابع اصلی
main() {
    echo -e "\n${GREEN}🎯 شروع فرآیند استقرار خودکار${NC}"
    echo "========================================"
    
    # بررسی وضعیت
    check_status
    
    # نمایش فایل‌های ایجاد شده
    show_created_files
    
    # ادغام با صفحه اصلی
    read -p "آیا می‌خواهید فایل‌ها با index.html ادغام شوند؟ (y/n): " integrate
    if [ "$integrate" = "y" ] || [ "$integrate" = "Y" ]; then
        integrate_with_index
    fi
    
    # ارسال به GitHub
    read -p "آیا می‌خواهید تغییرات به GitHub ارسال شوند؟ (y/n): " push
    if [ "$push" = "y" ] || [ "$push" = "Y" ]; then
        push_to_github
        check_deployment
    fi
    
    # گزارش نهایی
    echo -e "\n${GREEN}🎉 فرآیند کامل شد!${NC}"
    echo ""
    echo "📋 خلاصه:"
    echo "   ✅ فایل‌های جدید ایجاد شدند"
    echo "   ✅ پشتیبان از index.html گرفته شد"
    if [ "$integrate" = "y" ] || [ "$integrate" = "Y" ]; then
        echo "   ✅ فایل‌ها با index.html ادغام شدند"
    fi
    if [ "$push" = "y" ] || [ "$push" = "Y" ]; then
        echo "   ✅ تغییرات به GitHub ارسال شدند"
        echo "   ⏱️  استقرار خودکار در حال انجام است"
    fi
    echo ""
    echo "🚀 برای مشاهده تغییرات، چند دقیقه صبر کنید سپس صفحات را بازدید کنید"
}

# اجرای اسکریپت
main "$@"
